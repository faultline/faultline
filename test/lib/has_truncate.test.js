'use strict';
const describe = require('mocha').describe;
const it = require('mocha').it;
const assert = require('power-assert');
const hashTruncate = require('../../src/lib/hash_truncate');

String.prototype.bytes = function(){
    return(encodeURIComponent(this).replace(/%../g,'x').length);
};

describe('hashTruncate', () => {
    it ('hashTruncate("short string") -> "short string"', () => {
        assert(hashTruncate('short string') === 'short string');
    });

    it ('reversedUnixtime("long long string") -> prefix + hash)', () => {
        const longLongString = '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789';
        const truncated = hashTruncate(longLongString).bytes() + 'projects/'.length + 256 + '/errors/'.length + '/occurrences/0000000000000000.json'.length;
        assert(truncated === 1024);
    });
});
