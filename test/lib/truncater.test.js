'use strict';
const describe = require('mocha').describe;
const it = require('mocha').it;
const assert = require('power-assert');
const truncater = require('../../src/lib/truncater');

String.prototype.bytes = function(){
    return(encodeURIComponent(this).replace(/%../g,'x').length);
};

describe('truncater', () => {
    it ('truncateMessage("short string") -> "short string"', () => {
        assert(truncater.truncateMessage('short string') === 'short string');
    });

    it ('truncateMessage("long long string") -> prefix + hash)', () => {
        const longLongString = '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789';
        const truncated = truncater.truncateMessage(longLongString).bytes() + 'projects/'.length + 256 + '/errors/'.length + '/occurrences/0000000000000000.json'.length;
        assert(truncated === 1024);
    });

    it ('truncateTitle("short string") -> "short string"', () => {
        assert(truncater.truncateTitle('short string') === 'short string');
    });

    it ('truncateTitle("long long string") -> prefix + minHash)', () => {
        const longLongString = '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
              + '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789';
        const truncated = truncater.truncateTitle(longLongString).bytes();
        assert(truncated === 250);
    });
});
